"use strict";const favsSection=document.querySelector(".js_favorites"),charactersList=document.querySelector(".js_characters_list"),favsList=document.querySelector(".js_favorites_list"),forms=document.querySelectorAll(".js_form"),searchInput=document.querySelector(".js_search_input"),searchBtn=document.querySelector(".js_search_btn"),resetBtn=document.querySelector(".js_reset_btn");let characters=[],favoriteCharacters=[],searchedCharacters=[],favSearchedCharacters=[];function getAPIinfo(){fetch("https://www.breakingbadapi.com/api/characters",{method:"GET"}).then(e=>e.json()).then(e=>{characters=e,getFromLocalStorage(),paintCharactersCards(characters)})}function renderCard(e){const a=document.createElement("li");a.classList.add("characters__list_item");const t=document.createElement("article");t.classList.add("js_card"),t.classList.add("characters__card"),t.setAttribute("id",e.char_id),t.setAttribute("data-id",e.char_id);const r=document.createElement("div");r.setAttribute("style","background-image:url('"+e.img),r.classList.add("characters__img");const c=document.createElement("h2"),s=document.createTextNode(""+e.name);c.classList.add("characters__name"),c.appendChild(s);const d=document.createElement("h3"),n=document.createTextNode(""+e.status);return d.classList.add("characters__status"),d.appendChild(n),t.appendChild(r),t.appendChild(c),t.appendChild(d),a.appendChild(t),a}function paintCharactersCards(e){charactersList.innerHTML="";for(let a=0;a<e.length;a++)charactersList.appendChild(renderCard(e[a]));selectCardListener()}function handleSearch(e){e.preventDefault();const a=searchInput.value.toLowerCase();searchedCharacters=characters.filter(e=>e.name.toLowerCase().includes(a));for(let e=0;e<favoriteCharacters.length;e++){let a=searchedCharacters.find(a=>a.char_id===favoriteCharacters[e].char_id);void 0!==a&&favSearchedCharacters.push(a)}if(0===favSearchedCharacters.length)paintCharactersCards(searchedCharacters),selectCardListener();else if(0!==favSearchedCharacters.length){charactersList.innerHTML="";for(let e=0;e<favSearchedCharacters.length;e++){charactersList.appendChild(renderCard(favSearchedCharacters[e]));document.getElementById(favSearchedCharacters[e].char_id).classList.add("selected");const a=searchedCharacters.findIndex(a=>a.char_id===favSearchedCharacters[e].char_id);searchedCharacters.splice(a,1)}for(let e=0;e<searchedCharacters.length;e++)charactersList.appendChild(renderCard(searchedCharacters[e]));selectCardListener()}}getAPIinfo(),searchBtn.addEventListener("click",handleSearch);for(const e of forms)e.addEventListener("submit",e=>{e.preventDefault()});function renderFavCard(e){const a=document.createElement("li"),t=document.createElement("article");t.classList.add("js_card"),t.classList.add("selected"),t.classList.add("favorites__card");const r=document.createElement("p"),c=document.createElement("i");c.classList.add("fa-solid"),c.classList.add("fa-xmark"),r.appendChild(c),r.classList.add("js_remove_fav"),r.classList.add("favorites__cross--remove"),r.setAttribute("data-id",e.char_id);const s=document.createElement("div");s.setAttribute("style","background-image:url('"+e.img),s.classList.add("favorites__img");const d=document.createElement("h2"),n=document.createTextNode(""+e.name);d.classList.add("favorites__name"),d.appendChild(n);const i=document.createElement("h3"),o=document.createTextNode(""+e.status);return i.classList.add("favorites__status"),i.appendChild(o),t.appendChild(r),t.appendChild(s),t.appendChild(d),t.appendChild(i),a.appendChild(t),a}function paintFavCharacters(){favsList.innerHTML="",favsSection.classList.remove("collapsed");for(const e of favoriteCharacters)favsList.appendChild(renderFavCard(e));removeCardListener()}function handleSelection(e){const a=parseInt(e.currentTarget.dataset.id),t=characters.find(e=>e.char_id===a),r=favoriteCharacters.findIndex(e=>e.char_id===a);-1===r?(favoriteCharacters.push(t),paintFavCharacters(),setInLocalStorage(favoriteCharacters)):favoriteCharacters.length>1?(favoriteCharacters.splice(r,1),paintFavCharacters(),setInLocalStorage(favoriteCharacters)):(favoriteCharacters.splice(r,1),favsSection.classList.add("collapsed"),localStorage.removeItem(""))}function selectCardListener(){document.querySelectorAll(".js_card").forEach(e=>{e.addEventListener("click",handleSelection)})}function handleRemove(e){const a=parseInt(e.currentTarget.dataset.id),t=favoriteCharacters.findIndex(e=>e.char_id===a);favoriteCharacters.length>1?(favoriteCharacters.splice(t,1),paintFavCharacters(),setInLocalStorage(favoriteCharacters)):(favoriteCharacters.splice(t,1),favsSection.classList.add("collapsed"),localStorage.removeItem("Favorites"))}function handleRemoveAll(){favoriteCharacters=[],favsSection.classList.add("collapsed"),localStorage.removeItem("Favorites"),paintCharactersCards(characters)}function removeCardListener(){document.querySelectorAll(".js_remove_fav").forEach(e=>{e.addEventListener("click",handleRemove)})}function setInLocalStorage(e){localStorage.setItem("Favorites",JSON.stringify(e))}function getFromLocalStorage(){const e=JSON.parse(localStorage.getItem("Favorites"));null!==e&&(favoriteCharacters=e,paintFavCharacters())}resetBtn.addEventListener("click",handleRemoveAll);